#!/bin/bash

DESC="Installing boot bundle"

source /scripts/functions

log_begin_msg "${DESC}"
[ -e ${ROOTFS_SQUASH_FILE} ] && log_end_msg "cached"

{
  PKGS=(${PKGDIR}/boot/*)
  n=${#PKGS[*]}; i=0
  for pkg in "${PKGS[@]}"; do
    PCT=$(( 90*(++i)/n ))
cat <<EOF
XXX
$PCT
Unpacking $(basename ${pkg} .deb)...
XXX
EOF
    dpkg --unpack ${pkg}
  done
cat <<EOF
XXX
$PCT
Configuring packages...
XXX
EOF
  dpkg --configure -a >/dev/null 2>&1
  mkdir -p ${ISODIR}/boot
  cp /boot/vmlinuz-* ${ISODIR}/boot
  cp /boot/initrd.img-* ${ISODIR}/boot
} | whiptail --title "${DESC}" \
  --gauge "Calculating..." $LINES $COLUMNS 0

log_end_msg "done"
