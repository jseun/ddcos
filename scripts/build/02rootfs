#!/bin/bash

DESC="Copying root filesystem"
ROOTFS="/tmp/rootfs"; mkdir -p $ROOTFS

source /tmp/scripts/functions
log_begin_msg "${DESC}"

{
  DIRS=($(find / -type d -print 2>/dev/null | \
    egrep -v "^(/proc|/dev|/sys|/tmp|/boot)" | sort))
  n=${#DIRS[*]}; i=0
  for dir in "${DIRS[@]:1}"; do
    destdir=${ROOTFS}${dir}
    PCT=$(( 99*(++i)/n ))
cat <<EOF
XXX
$PCT
Copying directory ${dir}...
XXX
EOF
    [ -d $destdir ] || mkdir $destdir
    cp -d ${dir}/* $destdir 2>/dev/null
  done
  (cd $ROOTFS; mkdir proc dev sys tmp boot)
} | whiptail --title "${DESC}" \
  --gauge "Calculating..." 10 78 0

log_end_msg
